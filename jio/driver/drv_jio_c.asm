uiTransmit:
	CALL	_ENT_PARM_DIRECT_L09
	BIT	1,(IX+8)
	JR	Z,_0001
_0000:
	LD	L,(IX+10)
	LD	H,(IX+11)
	PUSH	HL
	CALL	uiXModemCRC16
	POP	AF
	LD	(IX+10),L
	LD	(IX+11),H
_0001:
	LD	C,(IX+4)
	LD	B,(IX+5)
	LD	E,(IX+2)
	LD	D,(IX+3)
	CALL	vJIOTransmit
	XOR	A
	OR	(IX+12)
	JR	Z,_0003
	BIT	1,(IX+8)
	JR	Z,_0003
_0005:
_0004:
_0002:
	LD	BC,2
	LD	HL,10
	ADD	HL,SP
	EX	DE,HL
	CALL	vJIOTransmit
_0003:
	LD	L,(IX+10)
	LD	H,(IX+11)
	JP	_LEAVE_DIRECT_L09
ucReceive:
	CALL	_ENT_PARM_DIRECT_L09
_0058:
_0007:
	LD	C,(IX+4)
	LD	B,(IX+5)
	LD	E,(IX+2)
	LD	D,(IX+3)
	CALL	bJIOReceive
	OR	A
	JR	NZ,_0006
_0008:
	BIT	2,(IX+8)
	JR	Z,_0058
_0009:
	LD	A,3
	JR	_0011
_0010:
_0006:
	XOR	A
_0011:
	JP	_LEAVE_DIRECT_L09
ucDoCommand:
	CALL	_ENT_AUTO_DIRECT_L09
	DEFW	65510
	PUSH	IY
	LD	HL,W_FLAGS
	LD	C,(IX+12)
	LD	B,(IX+13)
	ADD	HL,BC
	LD	D,(HL)
	LD	IYH,D
	LD	HL,W_COMMAND
	ADD	HL,BC
	LD	B,(HL)
	LD	(IX-4),B
	LD	(IX-18),74
	LD	(IX-17),73
	LD	(IX-16),79
	LD	(IX-15),D
	LD	HL,36
	ADD	HL,SP
	INC	HL
	LD	B,(HL)
	DEC	HL
	LD	(HL),B
	LD	C,(IX+4)
	LD	B,(IX+5)
	LD	L,(IX+2)
	LD	H,(IX+3)
	LD	(IX-13),L
	LD	(IX-12),H
	LD	(IX-11),C
	LD	(IX-10),B
	LD	B,(IX+8)
	LD	(IX-9),B
	LD	L,(IX+10)
	LD	H,(IX+11)
	LD	(IX-8),L
	LD	(IX-7),H
	LD	L,B
	LD	H,L
	LD	L,0
	ADD	HL,HL
	LD	(IX-26),L
	LD	(IX-25),H
_0014:
	LD	B,(IX-4)
	LD	(IX-14),B
	LD	A,B
	CP	18
	JR	Z,_0016
	CP	19
	JR	Z,_0016
	XOR	A
	JR	_0017
_0016:
	LD	A,1
_0017:
	LD	C,A
	PUSH	BC
	LD	HL,0
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	BC,5
	LD	L,16
	ADD	HL,SP
	EX	DE,HL
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
	LD	A,(IX-4)
	CP	19
	JR	NZ,_0019
_0018:
	LD	C,IYH
	PUSH	BC
	LD	BC,2
	LD	HL,27
	ADD	HL,SP
	EX	DE,HL
	CALL	ucReceive
	POP	HL
	LD	IYL,A
	OR	A
	JR	NZ,_0027
_0020:
	LD	HL,17476
	LD	C,(IX-3)
	LD	B,(IX-2)
	AND	A
	SBC	HL,BC
	JR	NZ,_0023
_0022:
	LD	IYL,20
	JR	_0027
_0023:
	LD	HL,21845
	AND	A
	SBC	HL,BC
	JR	NZ,_0026
_0025:
	LD	IYL,21
	JR	_0027
_0026:
	LD	IYL,5
_0027:
_0024:
_0021:
	JP	_0051
_0019:
	CP	17
	JR	NZ,_0030
_0029:
	LD	C,0
	PUSH	BC
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	BC,7
	LD	HL,21
	ADD	HL,SP
	EX	DE,HL
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
	LD	C,1
	PUSH	BC
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	C,(IX-26)
	LD	B,(IX-25)
	LD	E,(IX+10)
	LD	D,(IX+11)
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
	LD	C,IYH
	PUSH	BC
	LD	BC,2
	LD	HL,27
	ADD	HL,SP
	EX	DE,HL
	CALL	ucReceive
	POP	HL
	LD	IYL,A
	OR	A
	JR	NZ,_0040
_0031:
	LD	HL,8738
	LD	C,(IX-3)
	LD	B,(IX-2)
	AND	A
	SBC	HL,BC
	JR	NZ,_0034
_0033:
	LD	HL,13107
	AND	A
	SBC	HL,BC
	JR	NZ,_0036
	LD	A,1
	JR	_0037
_0036:
	LD	A,11
_0037:
	LD	IYL,A
	JR	_0051
_0034:
	LD	HL,4369
	AND	A
	SBC	HL,BC
	JR	Z,_0051
_0039:
	LD	IYL,5
_0040:
_0038:
_0032:
	JR	_0051
_0030:
	CP	16
	JR	NZ,_0043
_0042:
	LD	C,1
	PUSH	BC
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	BC,7
	LD	HL,21
	ADD	HL,SP
	EX	DE,HL
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
_0043:
	LD	C,IYH
	PUSH	BC
	LD	C,(IX-26)
	LD	B,(IX-25)
	LD	E,(IX+10)
	LD	D,(IX+11)
	CALL	ucReceive
	POP	HL
	LD	IYL,A
	OR	A
	JR	NZ,_0051
	LD	B,IYH
	BIT	0,B
	JR	Z,_0051
_0047:
_0046:
_0044:
	LD	C,IYH
	PUSH	BC
	LD	BC,2
	LD	HL,6
	ADD	HL,SP
	EX	DE,HL
	CALL	ucReceive
	POP	HL
	LD	IYL,A
	OR	A
	JR	NZ,_0051
_0048:
	LD	L,A
	LD	H,A
	PUSH	HL
	LD	C,(IX-26)
	LD	B,(IX-25)
	LD	E,(IX+10)
	LD	D,(IX+11)
	CALL	uiXModemCRC16
	POP	AF
	LD	C,(IX-24)
	LD	B,(IX-23)
	AND	A
	SBC	HL,BC
	JR	Z,_0051
_0050:
	LD	IYL,5
_0051:
_0049:
_0045:
_0041:
_0028:
	LD	B,IYL
	INC	B
	DEC	B
	JR	Z,_0053
	LD	A,IYL
	CP	20
	JR	Z,_0053
	CP	21
	JR	Z,_0053
_0055:
_0054:
_0052:
	LD	(IX-14),B
	LD	C,1
	PUSH	BC
	LD	HL,0
	PUSH	HL
	LD	C,IYH
	PUSH	BC
	LD	BC,5
	LD	L,16
	ADD	HL,SP
	EX	DE,HL
	CALL	uiTransmit
	POP	AF
	POP	AF
	POP	AF
_0053:
	LD	B,IYL
	INC	B
	DEC	B
	JR	Z,_0012
	LD	A,IYL
	CP	20
	JR	Z,_0012
	CP	21
	JR	Z,_0012
	LD	B,IYH
	BIT	3,B
	JP	NZ,_0014
_0012:
	LD	A,IYL
	POP	IY
	JP	_LEAVE_DIRECT_L09
